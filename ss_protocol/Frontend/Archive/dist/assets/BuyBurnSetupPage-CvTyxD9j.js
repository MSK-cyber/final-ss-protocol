import{u as ie,r as b,g as z,R as oe,j as e,Z as m,f as D,b as G,n as j,c as i,d as k,p as B,V as de}from"./index-Fje8cVxI.js";function pe(){var $,I;const{BuyAndBurnController:l,AuctionContract:F}=ie(),[me,ue]=b.useState(2),[u,h]=b.useState(!1),[E,V]=b.useState(!1),[s,H]=b.useState({poolAddress:null,vaultPoolAddress:null,plsBalance:null,wplsBalance:null,stateBalance:null,stateReserve:null,wplsReserve:null,burnedLP:null,lpTotalSupply:null,stateSymbol:"STATE",wplsSymbol:"WPLS",stateDecimals:18,wplsDecimals:18}),[R,J]=b.useState(null),[he,xe]=b.useState(""),[p,T]=b.useState({stateAmount:"",wplsAmount:"",plsToWrap:""}),v=((I=($=z())==null?void 0:$.network)==null?void 0:I.explorerUrl)||"https://scan.pulsechain.com",A=t=>t?`${t.slice(0,10)}â€¦${t.slice(-6)}`:"",K=(t,a=2)=>{if(t==null||Number.isNaN(t))return"â€”";try{return new Intl.NumberFormat(void 0,{notation:"compact",maximumFractionDigits:a}).format(t)}catch{return Number(t).toLocaleString(void 0,{maximumFractionDigits:a})}},N=(t,a=18,n=6)=>{try{return Number(D(t??0n,a)).toLocaleString(void 0,{maximumFractionDigits:n})}catch{return"â€”"}},S=async(t,a="Copied!")=>{try{await navigator.clipboard.writeText(t),j(a)}catch{i("Copy failed")}},g=(t,a)=>{const n=`${v}/tx/${a}`;de.success(e.jsxs("span",{children:[t,a?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"underline"},children:"View on explorer"})]}):null]}),{duration:7e3})},x=async()=>{var t,a,n,c,o,f;if(l){V(!0);try{const r=await l.getControllerStatus(),w=r==null?void 0:r[3],ae=r==null?void 0:r[4],le=r==null?void 0:r[5],ne=r==null?void 0:r[0],re=r==null?void 0:r[1],ce=r==null?void 0:r[2];let L=w||m;if((!L||L===m)&&F&&((t=cfg==null?void 0:cfg.addresses)!=null&&t.state))try{const d=cfg.addresses.state;L=await F.getPairAddress(d).catch(()=>m)}catch{}let M=18,U=18,_="STATE",O="WPLS";try{const d=z(),C=(c=(n=(a=d==null?void 0:d.contracts)==null?void 0:a.core)==null?void 0:n.STATE_V3)==null?void 0:c.address,y=(f=(o=d==null?void 0:d.dex)==null?void 0:o.baseToken)==null?void 0:f.address,W=["function symbol() view returns (string)","function decimals() view returns (uint8)"],Q=l.runner||l.provider;if(C){const P=new k(C,W,Q);try{_=await P.symbol()}catch{}try{M=Number(await P.decimals())}catch{}}if(y){const P=new k(y,W,Q);try{O=await P.symbol()}catch{}try{U=Number(await P.decimals())}catch{}}}catch{}let Z=null,q=null;if(w&&w!==m)try{const d=["function balanceOf(address) view returns (uint256)","function totalSupply() view returns (uint256)"],C=l.runner||l.provider,y=new k(w,d,C);Z=await y.balanceOf("0x000000000000000000000000000000000000dEaD"),q=await y.totalSupply()}catch{}H({poolAddress:w,vaultPoolAddress:L,plsBalance:ne,wplsBalance:re,stateBalance:ce,stateReserve:ae,wplsReserve:le,burnedLP:Z,lpTotalSupply:q,stateSymbol:_,wplsSymbol:O,stateDecimals:M,wplsDecimals:U}),J(new Date)}catch(r){console.debug("fetchPoolStatus failed:",(r==null?void 0:r.message)||r)}finally{V(!1)}}},X=async()=>{try{const t=s==null?void 0:s.vaultPoolAddress;if(!t||t===m)return i("DAV Vault STATE pool not found");if(!l)return i("Controller not available");h(!0);const a=await l.setStateWplsPool(t);g("Linked controller to DAV Vault STATE/WPLS pool",a.hash),await a.wait(),j("Controller pool updated"),x()}catch(t){console.error(t),i((t==null?void 0:t.reason)||(t==null?void 0:t.shortMessage)||(t==null?void 0:t.message)||"Failed to link pool")}finally{h(!1)}},Y=async()=>{var t;try{const a=(l==null?void 0:l.target)||await((t=l==null?void 0:l.getAddress)==null?void 0:t.call(l));if(!a){i("Controller address unavailable");return}const n=prompt("Enter PLS amount to send to controller");if(!n)return;let c;try{if(c=B(n),c<=0n)throw new Error("")}catch{i("Invalid amount");return}const o=l==null?void 0:l.runner;if(!o||typeof o.sendTransaction!="function"){i("Wallet not connected to send PLS");return}const f=await o.sendTransaction({to:a,value:c});g("Send PLS submitted",f.hash),await f.wait(),j("PLS sent to controller"),x()}catch(a){i((a==null?void 0:a.reason)||(a==null?void 0:a.shortMessage)||(a==null?void 0:a.message)||"Failed to send PLS")}};oe.useEffect(()=>{x();const t=setInterval(x,15e3);return()=>clearInterval(t)},[l]);const ee=async t=>{if(t.preventDefault(),!l)return i("BuyAndBurnController not available");let a,n,c;try{if(a=B(p.stateAmount||"0"),n=B(p.wplsAmount||"0"),c=B(p.plsToWrap||"0"),a<=0n||n<=0n&&c<=0n)return i("Provide STATE amount and either WPLS or PLS to wrap")}catch{return i("Invalid amount format")}h(!0);try{const o=await l.createPoolOneClick(a,n,{value:c});console.log("Create pool tx:",o.hash),g("Pool creation submitted",o.hash),await o.wait(),j("STATE/WPLS pool created â€¢ Initial LP burned"),x()}catch(o){console.error(o),i(o.message||"Failed to create pool")}finally{h(!1)}},se=async()=>{if(!l)return i("BuyAndBurnController not available");h(!0);try{const t=await l.convertPLSToWPLS();console.log("Convert PLS->WPLS tx:",t.hash),g("Convert PLS â†’ WPLS submitted",t.hash),await t.wait(),j("Converted all available PLS to WPLS"),x()}catch(t){console.error(t),i(t.message||"Failed to convert PLS to WPLS")}finally{h(!1)}},te=async()=>{if(!l)return i("BuyAndBurnController not available");h(!0);try{let t=0n,a=0n;try{const c=await l.getControllerStatus();t=BigInt((c==null?void 0:c[0])??0),a=BigInt((c==null?void 0:c[1])??0)}catch{}let n;if(t>0n)n=await l.executeFullBuyAndBurn(),console.log("Execute Full Buy & Burn tx:",n.hash),g("Full Buy & Burn submitted",n.hash);else if(a>0n)n=await l.executeBuyAndBurn(),console.log("Execute Buy & Burn tx:",n.hash),g("Buy & Burn submitted",n.hash);else{i("Controller has no funds. Send PLS to the controller and/or click Convert PLS â†’ WPLS, or transfer WPLS directly to the controller.");return}await n.wait(),j("Buy & Burn executed successfully"),x()}catch(t){console.error(t),i(t.reason||t.shortMessage||t.message||"Failed to execute Buy & Burn")}finally{h(!1)}};return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h5",{className:"card-title mb-0",children:"ðŸ’° Buy & Burn"}),e.jsx("small",{className:"text-muted",children:"Create the STATE/WPLS pool, then execute Buy & Burn"})]}),e.jsxs("div",{className:"card-body",children:[(s==null?void 0:s.poolAddress)&&s.poolAddress!==m&&e.jsxs("div",{className:"mb-4 p-3 border rounded bg-dark text-white",children:[e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-water text-info"}),e.jsx("strong",{children:"STATE / WPLS Pool"}),(s==null?void 0:s.vaultPoolAddress)&&(s==null?void 0:s.poolAddress)&&s.vaultPoolAddress.toLowerCase()===s.poolAddress.toLowerCase()?e.jsx("span",{className:"badge bg-success",children:"Aligned with DAV Vault"}):s!=null&&s.vaultPoolAddress&&s.vaultPoolAddress!==m?e.jsx("span",{className:"badge bg-warning text-dark",children:"Mismatch with DAV Vault"}):e.jsx("span",{className:"badge bg-secondary",children:"Detected"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[R&&e.jsxs("small",{className:"text-muted",children:["Updated ",R.toLocaleTimeString()]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-light",onClick:x,disabled:E,title:"Refresh",children:E?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Refreshingâ€¦"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"})," Refresh"]})})]})]}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-25 h-100",children:[e.jsx("div",{className:"small text-white mb-1",children:"Controller Pool Address"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("a",{href:`${v}/address/${s.poolAddress}`,target:"_blank",rel:"noopener noreferrer",className:"text-info",children:A(s.poolAddress)}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-light",onClick:()=>S(s.poolAddress,"Controller pool copied"),children:e.jsx("i",{className:"bi bi-files"})})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-25 h-100",children:[e.jsx("div",{className:"small text-white mb-1",children:"DAV Vault STATE/WPLS Pool"}),e.jsx("div",{className:"d-flex align-items-center gap-2",children:s!=null&&s.vaultPoolAddress&&s.vaultPoolAddress!==m?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`${v}/address/${s.vaultPoolAddress}`,target:"_blank",rel:"noopener noreferrer",className:"text-info",children:A(s.vaultPoolAddress)}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-light",onClick:()=>S(s.vaultPoolAddress,"DAV Vault pool copied"),children:e.jsx("i",{className:"bi bi-files"})})]}):e.jsx("span",{className:"text-muted",children:"â€” not found â€”"})}),(s==null?void 0:s.vaultPoolAddress)&&(s==null?void 0:s.poolAddress)&&s.vaultPoolAddress.toLowerCase()!==s.poolAddress.toLowerCase()&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{type:"button",className:"btn btn-sm btn-warning text-dark",onClick:X,disabled:u,title:"Link controller pool to DAV Vault",children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Linkingâ€¦"]}):e.jsx(e.Fragment,{children:"Use DAV Vault Pool"})})})]})})]}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-25 h-100",children:[e.jsx("div",{className:"small text-white mb-1",children:"Controller Wallet"}),e.jsx("div",{className:"d-flex align-items-center gap-2",children:(()=>{var a;const t=(l==null?void 0:l.target)||((a=l==null?void 0:l.getAddress)==null?void 0:a.call(l))||"";return e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`${v}/address/${t}`,target:"_blank",rel:"noopener noreferrer",className:"text-info",children:A(t)}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-light",onClick:()=>S(t,"Controller address copied"),title:"Copy address",children:e.jsx("i",{className:"bi bi-files"})}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-info",onClick:Y,title:"Send PLS to controller",children:[e.jsx("i",{className:"bi bi-currency-exchange me-1"})," Send PLSâ€¦"]})]})})()})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-25 h-100",children:[e.jsx("div",{className:"small text-white mb-1",children:"Controller Balances"}),e.jsxs("div",{className:"d-flex flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:"PLS"}),e.jsx("div",{className:"fw-semibold",children:N(s.plsBalance,18,6)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:s.wplsSymbol}),e.jsx("div",{className:"fw-semibold",children:N(s.wplsBalance,s.wplsDecimals,6)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"small text-muted",children:s.stateSymbol}),e.jsx("div",{className:"fw-semibold",children:N(s.stateBalance,s.stateDecimals,6)})]})]})]})})]}),s!=null&&s.poolAddress&&s.poolAddress!==m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-25 h-100",children:[e.jsx("div",{className:"small text-white mb-1",children:"Current Ratio"}),(()=>{const t=s.stateReserve?Number(D(s.stateReserve,s.stateDecimals)):0,a=s.wplsReserve?Number(D(s.wplsReserve,s.wplsDecimals)):0;if(t>0&&a>0){const n=a/t,c=t/a;return e.jsxs(e.Fragment,{children:[e.jsxs("h5",{className:"mb-1",children:["1 ",s.stateSymbol," = ",e.jsx("span",{className:"text-info",children:n.toFixed(6)})," ",s.wplsSymbol]}),e.jsxs("div",{className:"text-white",children:["1 ",s.wplsSymbol," = ",c.toFixed(6)," ",s.stateSymbol]})]})}return e.jsx("span",{className:"text-muted",children:"â€”"})})()]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-25 h-100",children:[e.jsx("div",{className:"small text-white mb-1",children:"Pool Address"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("a",{href:`${v}/address/${s.poolAddress}`,target:"_blank",rel:"noopener noreferrer",className:"text-info",children:A(s.poolAddress)}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-light",onClick:()=>S(s.poolAddress,"Pool address copied"),title:"Copy address",children:e.jsx("i",{className:"bi bi-files"})})]})]})})]}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-10 h-100",children:[e.jsxs("div",{className:"small text-white mb-1",children:[s.stateSymbol," Reserve"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-coin text-warning"}),e.jsx("span",{className:"fw-semibold",children:N(s.stateReserve,s.stateDecimals,6)})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-10 h-100",children:[e.jsxs("div",{className:"small text-white mb-1",children:[s.wplsSymbol," Reserve"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-droplet text-info"}),e.jsx("span",{className:"fw-semibold",children:N(s.wplsReserve,s.wplsDecimals,6)})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"p-3 rounded bg-secondary bg-opacity-10 h-100",children:[e.jsx("div",{className:"small text-white mb-1",children:"Burned LP"}),(()=>{if(s.burnedLP==null)return e.jsx("span",{className:"text-muted",children:"â€”"});const t=Number(G(s.burnedLP)),a=s.lpTotalSupply?Number(G(s.lpTotalSupply)):0,n=a>0?t/a*100:0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-fire text-danger"}),e.jsx("span",{className:"fw-semibold",children:K(t,4)}),e.jsxs("span",{className:"badge bg-danger bg-opacity-75",children:[n.toFixed(2),"%"]})]}),e.jsx("div",{className:"progress mt-2",style:{height:6},children:e.jsx("div",{className:"progress-bar bg-danger",role:"progressbar",style:{width:`${Math.min(100,Math.max(0,n))}%`}})})]})})()]})})]})]}):e.jsxs("div",{className:"text-muted d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-exclamation-circle"})," No pool detected yet"]})]}),!(s!=null&&s.poolAddress&&s.poolAddress!==m)&&e.jsxs("form",{onSubmit:ee,children:[e.jsx("h6",{className:"text-primary mb-3",children:"ðŸŠ Create Buy & Burn Pool"}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"STATE Amount (from SWAP vault)"}),e.jsx("input",{type:"number",step:"0.000000000000000001",className:"form-control",value:p.stateAmount,onChange:t=>T(a=>({...a,stateAmount:t.target.value})),placeholder:"5000.0",required:!0})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"WPLS Amount (from governance)"}),e.jsx("input",{type:"number",step:"0.000000000000000001",className:"form-control",value:p.wplsAmount,onChange:t=>T(a=>({...a,wplsAmount:t.target.value})),placeholder:"1000.0"}),e.jsx("small",{className:"text-muted",children:"Optional if sending PLS to wrap below"})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"PLS to Wrap (msg.value)"}),e.jsx("input",{type:"number",step:"0.000000000000000001",className:"form-control",value:p.plsToWrap,onChange:t=>T(a=>({...a,plsToWrap:t.target.value})),placeholder:"1000.0"}),e.jsx("small",{className:"text-muted",children:"Optional: controller wraps PLS into WPLS"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-success",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Creating Pool..."]}):"Create Buy & Burn Pool"})})]}),(s==null?void 0:s.poolAddress)&&s.poolAddress!==m&&e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("button",{type:"button",className:"btn w-100 btn-outline-warning",onClick:se,disabled:u||!(s!=null&&s.plsBalance&&BigInt(s.plsBalance)>0n),children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Converting PLS to WPLS..."]}):e.jsxs(e.Fragment,{children:["Convert PLS â†’ WPLS",!(s!=null&&s.plsBalance&&BigInt(s.plsBalance)>0n)&&e.jsx("span",{className:"ms-2 badge bg-secondary",children:"Needs PLS"})]})})}),e.jsx("div",{className:"col-md-6",children:e.jsx("button",{type:"button",className:"btn w-100 btn-outline-danger",onClick:te,disabled:u||!(s!=null&&s.plsBalance&&BigInt(s.plsBalance)>0n||s!=null&&s.wplsBalance&&BigInt(s.wplsBalance)>0n),children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Executing Buy & Burn..."]}):"Execute Buy & Burn"})})]})]})]})}export{pe as default};
